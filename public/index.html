<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>RettiwT - An experiment with Fluid, Blueprint &amp; Gears</title>
  <link rel="stylesheet" href="stylesheets/blueprint/screen.css" type="text/css" media="screen, projection">
  <link rel="stylesheet" href="stylesheets/blueprint/plugins/fancy-type/screen.css" type="text/css" media="screen, projection">
  <style type="text/css">
    body       { background: #000; 

    }
    .container { background: #333; }
    input      { background: #333; border: 2px solid #555; color: #999;}
    select     { background: #333; border: 1px solid #555; color: #999;}
    a          { color: #999; }
    
    .item       { background: #333; border-bottom: 1px dotted #111; }
    .selected   { background: #a00; }
    .seen       { background: #00a; }
    
  </style>
  <script type="text/javascript" src="javascripts/jquery.js"></script>
  
  <script type="text/javascript" src="javascripts/rettiwt/rtweetfactory.js"></script>
  <script type="text/javascript" src="javascripts/rettiwt/rtweetlist.js"></script>
  <script type="text/javascript" src="javascripts/rettiwt/rtweetrouter.js"></script>
  
  
  
  <script type="text/javascript" src="javascripts/twitter.js"></script>
  <script type="text/javascript" src="javascripts/mocks.js"></script>
  <script type="text/javascript">
    jQuery(function(){
      // example: badge and growl
      //
      // window.console.log("badge");
      // window.fluid.dockBadge = ""
      // 
      // window.console.log("growl");
      // window.fluid.showGrowlNotification({
      //     title:       "Bork Bork Bork", 
      //     description: "RettiwT - Listening to your tweets! Far and wide!", 
      //     priority:    1, 
      //     sticky: false,
      //     identifier: "RettiwT"
      // });
      
      
      // FIXME: S
      RTweetRouter.accept(jQuery.map(mock_tweet_feed(), function(v,i){
        return RTweetFactory.parse_json(v);
      }).reverse());
      
    });
    
    
    // FIXME: This shouldn't be here!
    
    // SETUP SOME DEFAULT ROUTES ********************************************
    DefaultRTL = RTweetList('DEFAULT');
    RepliesRTL = RTweetList('REPLIES');
    DirectsRTL = RTweetList('DIRECTS');

    RTweetRouter
      /* Simple Route, No Rules */
      .append("TIMELINE", function(route,rtweet) {
        DefaultRTL.add(rtweet);
      })

      /* Stupid Route, with a Rules example */
      .append("REPLIES", function(route,rtweet) {
        if (rtweet.tweet.text.match(/\@/)) {
          RepliesRTL.add(rtweet);
        }
      });
    // **********************************************************************
    
    
    // FIXME: Remove This Testing Nonsense!
    jQuery(document).bind('rettiwt.rtweet.create', function(evt,rtweet) {
      console.log("Event: rettiwt.rtweet.create for id=" + rtweet.tweet.id);
    });
    
    jQuery(document).bind('rettiwt.rtweetlist.add', function(evt,rt_list) {
      console.log("Event: rettiwt.retweetlist.add for [" + rt_list.name() + "] with c=" + rt_list.length() );
    });
    
    jQuery(document).bind('rettiwt.rtweetlist.add', function (evt, rtweetlist) {
      rtweetlist.each(function(i,rtweet){
        if (rtweet.state.rendered == true) return;
        rtweet.state.rendered = true;
        
        var tweet_id = 't_' + rtweet.tweet.id;
        var clone    = jQuery("#t").clone().attr('id',tweet_id).prependTo('.list');
        
        // add userpic
        jQuery("#" + tweet_id + " .userpic").attr('src', rtweet.user.profile_image_url);
        
        // add username
        jQuery("#" + tweet_id + " .name"   ).html(rtweet.user.screen_name);
        
        // add tweet text
        jQuery("#" + tweet_id + " .tweet"  ).html(rtweet.tweet.text + '/'  + rtweet.tweet.created_at);
        
        clone.show();
      });
    });    
    
    
  </script>

</head>
<body>
  <br/>
  <div class="container" style="border: 5px solid #222">
    
    <div class="span-14" style="border-bottom:5px solid #aaa">
      <select style="width:100%">
        <optgroup label="TweetGroups">
          <option default>Active</option>
          <option>Boring</option>
        </optgroup>
        
        <optgroup label="Filters">
          <option>#bca4</option>
          <option>#BIL</option>
        </optgroup>
        
      </select>
    </div>
    
    
    <div class="span-14 list" style="border-bottom:5px solid #aaa;height:350px;overflow-y:scroll;overflow-x:hidden">
      
      <!-- template for all tweet-items -->
      <div class="container item" id="t" style="display:none">
        <div class="span-2">
          <img class="userpic" src="">
        </div>
        <div class="span-11">
          <strong class="name" style="color:#bbb"></strong>
          <span class="alt tweet"></span>
        </div>
        <div class="span-1 last">!!!</div>
      </div>
      
    </div>
    
    <div class="span-14">
      <div class="container">
        <div class="span-5">
          <input type="text" style="width:100%">
        </div>
        <div class="span-1 last">
          <input type="text" style="width:35px">
        </div>
      </div>
    </div>
  </div>
</body>
</html>